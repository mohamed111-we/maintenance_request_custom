<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

    <record id="view_maintenance_request_custom_form" model="ir.ui.view">
        <field name="name">maintenance.request.custom.form</field>
        <field name="model">maintenance.request.custom</field>
        <field name="arch" type="xml">
            <form string="Maintenance Request">
                <header>
                    <button string="Cancel" name="archive_equipment_request" type="object" invisible="archive"/>
                    <button string="Reopen Request" name="reset_equipment_request" type="object"
                            invisible="not archive"/>
                    <field name="stage_id" widget="statusbar" options="{'clickable': '1'}" invisible="archive"/>
                </header>
                <sheet>
                    <div invisible="not archive">
                        <span class="badge text-bg-warning float-end">Cancelled</span>
                    </div>
                    <field name="kanban_state" widget="state_selection"/>
                    <div class="oe_title">
                        <h1>
                            <label for="name"/>
                            <field name="name" placeholder="Example: Screen not working"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="equipment_id"/>
                            <field name="category_id"/>
                            <field name="department_id"/>
                            <field name="request_date"/>
                            <field name="close_date" readonly="1"/>
                            <field name="maintenance_type" widget="radio"/>
                            <field name="archive" invisible="1"/>
                        </group>
                        <group>
                            <field name="maintenance_team_id"/>
                            <field name="employee_id"/>
                            <field name="scheduled_date"/>
                            <label for="duration"/>
                            <div>
                                <field name="duration" widget="float_time" class="oe_inline"/>
                                <span class="ml8">hours</span>
                            </div>
                            <label for="recurring_maintenance" invisible="maintenance_type == 'corrective'"/>
                            <div class="d-inline-flex" invisible="maintenance_type == 'corrective'">
                                <field name="recurring_maintenance" nolabel="1" class="ms-0"
                                       style="width: fit-content;"/>
                            </div>
                            <label for="repeat_interval" invisible="not recurring_maintenance"/>
                            <div class="d-flex" invisible="not recurring_maintenance">
                                <field name="repeat_interval" required="recurring_maintenance" class="me-2"
                                       style="max-width: 2rem !important;"/>
                                <field name="repeat_unit" required="recurring_maintenance" class="me-2"
                                       style="max-width: 4rem !important;"/>
                                <field name="repeat_type" required="recurring_maintenance" class="me-2"
                                       style="max-width: 15rem !important;"/>
                                <field name="repeat_until" invisible="repeat_type != 'until'"
                                       required="repeat_type == 'until'" class="me-2"/>
                            </div>
                            <field name="priority" widget="priority"/>
                            <field name="email_cc"/>
                            <field name="machine_temperature"/>
                            <field name="work_area_temperature"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Notes">
                            <field name="description" placeholder="Internal notes"/>
                        </page>
                        <page string="Instructions">
                            <group col="1">
                                <field name="instruction_type" widget="radio" nolabel="1"/>
                                <field name="instruction_pdf" help="Upload your PDF file." widget="pdf_viewer"
                                       invisible="instruction_type != 'pdf'" required="instruction_type == 'pdf'"
                                       nolabel="1"/>
                                <field name="instruction_google_slide" placeholder="Google Slide Link"
                                       widget="embed_viewer" invisible="instruction_type != 'google_slide'"
                                       required="instruction_type == 'google_slide'" nolabel="1"/>
                                <field name="instruction_text" placeholder="Your instructions"
                                       invisible="instruction_type != 'text'" nolabel="1"/>
                            </group>
                        </page>
                        <page string="Preventive Maintenance Report">
                            <group>
                                <group>
                                    <field name="check_motors"/>
                                    <field name="check_connections"/>
                                    <field name="check_units"/>
                                    <field name="check_filters"/>
                                </group>
                                <group>
                                    <field name="check_screw"/>
                                    <field name="check_compressor"/>
                                    <field name="check_electrical"/>
                                </group>
                            </group>
                        </page>
                        <page string="Maintenance Technician">
                            <field name="line_ids">
                                <list editable="bottom">
                                    <field name="technician_id"/>
                                    <field name="work_hours"/>
                                    <field name="mc_notes"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>


    <record id="view_maintenance_request_custom_list" model="ir.ui.view">
        <field name="name">maintenance.request.custom.list</field>
        <field name="model">maintenance.request.custom</field>
        <field name="arch" type="xml">
            <list>
                <field name="name"/>
                <field name="equipment_id"/>
                <field name="employee_id"/>
                <field name="priority"/>
                <field name="maintenance_type"/>
                <field name="request_date" groups="base.group_no_one"/>
            </list>
        </field>
    </record>

    <record id="view_maintenance_request_custom_graph" model="ir.ui.view">
        <field name="name">maintenance.request.custom.graph</field>
        <field name="model">maintenance.request.custom</field>
        <field name="arch" type="xml">
            <graph string="maintenance Request" sample="1">
                <field name="employee_id"/>
                <field name="stage_id"/>
            </graph>
        </field>
    </record>

    <record id="view_maintenance_request_custom_pivot" model="ir.ui.view">
        <field name="name">equipment.request.custom.pivot</field>
        <field name="model">maintenance.request.custom</field>
        <field name="arch" type="xml">
            <pivot string="maintenance Request" sample="1">
                <field name="employee_id"/>
                <field name="stage_id"/>
                <field name="color" invisible="1"/>
            </pivot>
        </field>
    </record>

    <record id="view_maintenance_request_custom_kanban" model="ir.ui.view">
        <field name="name">equipment.request.custom.kanban</field>
        <field name="model">maintenance.request.custom</field>
        <field name="arch" type="xml">
            <kanban highlight_color="color" default_group_by="stage_id" sample="1">
                <field name="archive"/>
                <progressbar field="kanban_state" colors='{"done": "success", "blocked": "danger"}'/>
                <templates>
                    <t t-name="menu">
                        <t t-if="widget.editable">
                            <a role="menuitem" type="open" class="dropdown-item">Edit...</a>
                        </t>
                        <t t-if="widget.deletable">
                            <a role="menuitem" type="delete" class="dropdown-item">Delete</a>
                        </t>
                        <field name="color" widget="kanban_color_picker"/>
                    </t>
                    <t t-name="card">
                        <field name="name" class="fw-bold fs-5"/>
                        <span name="owner_user_id" t-if="record.owner_user_id.raw_value">Requested by:
                            <field name="owner_user_id"/>
                        </span>
                        <span t-if="record.equipment_id.raw_value">
                            <field name="equipment_id"/>
                            <span t-if="record.category_id.raw_value">(<field name="category_id"/>)
                            </span>
                        </span>
                        <field name="schedule_date"/>
                        <footer>
                            <div class="d-flex">
                                <field name="priority" widget="priority"/>
                                <field name="activity_ids" widget="kanban_activity" class="ms-3"/>
                            </div>
                            <div class="d-flex ms-auto align-items-center">
                                <div class="badge text-bg-warning float-end" invisible="not archive">
                                    Cancelled
                                </div>
                                <field name="kanban_state" widget="state_selection" class="ms-1"/>
                                <field name="employee_id" widget="many2one_avatar_user" class="ms-1"/>
                            </div>
                        </footer>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="view_maintenance_request_custom_activity" model="ir.ui.view">
        <field name="name">maintenance.request.custom.activity</field>
        <field name="model">maintenance.request.custom</field>
        <field name="arch" type="xml">
            <activity string="Maintenance Requests">
                <field name="employee_id"/>
                <templates>
                    <div t-name="activity-box">
                        <field name="employee_id" widget="many2one_avatar_user" domain="[('share', '=', False)]"/>
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between">
                                <field name="name" class="o_text_block o_text_bold"/>
                                <field name="priority" widget="priority" class="o_priority"/>
                            </div>
                            <div class="d-flex justify-content-between">
                                <field name="equipment_id" muted="1" display="full" class="o_text_block"/>
                                <field name="stage_id" class="o_text_block"/>
                            </div>
                            <field name="description" class="o_text_block"/>
                        </div>
                    </div>
                </templates>
            </activity>
        </field>
    </record>


    <record id="action_maintenance_request_custom" model="ir.actions.act_window">
        <field name="name">Maintenance Requests</field>
        <field name="res_model">maintenance.request.custom</field>
        <field name="view_mode">kanban,list,form,graph,pivot,activity</field>
    </record>


    <menuitem
            id="menu_maintenance_custom_requests_parent"
            name="Employee Requests"
            sequence="10"
            web_icon="maintenance_request_custom,static/description/icon.png"/>

    <menuitem
            id="menu_maintenance_custom_requests_action"
            name="Requests"
            parent="menu_maintenance_custom_requests_parent"
            action="action_maintenance_request_custom"
            sequence="20"/>


</odoo>